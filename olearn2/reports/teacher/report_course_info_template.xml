<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="report_course_info_template">
            <t t-call="web.html_container">
                <t t-set="data_report_margin_top" t-value="0"/>
                <style>
                    html, body {
                    margin-top: 2cm;
                    padding: 0;
                    }

                    h1, h2, h3, p {
                    margin-bottom: 0.5rem;
                    }

                    .page {
                    page-break-after: always;
                    padding: 0;
                    size: A4;
                    margin-top: 2cm;
                    margin-bottom: 2cm;
                    margin-left: 3cm;
                    margin-right: 1.5cm;
                    }

                    .text-center {
                    text-align: center;
                    }

                    .text-italic {
                    font-style: italic;
                    }

                    h1 {
                    color: #1E90FF;
                    margin-bottom: 0.3rem;
                    }

                    h2 {
                    color: #1E90FF;
                    border-bottom: 2px solid #1E90FF;
                    padding-bottom: 5px;
                    margin-top: 25px;
                    }

                    h3 {
                    color: #666;
                    margin-top: 20px;
                    }

                    .course-info {
                    margin: 20px 0;
                    padding: 15px;
                    border: 2px solid #1E90FF;
                    background-color: #f9f9f9;
                    }

                    .course-info p {
                    margin: 5px 0;
                    }

                    .info-label {
                    font-weight: bold;
                    color: #1E90FF;
                    }

                    .summary-section {
                    margin: 20px 0;
                    padding: 15px;
                    background-color: #f5f5f5;
                    border-left: 4px solid #1E90FF;
                    }

                    .summary-section h3 {
                    color: #1E90FF;
                    margin-bottom: 10px;
                    margin-top: 0;
                    }

                    .summary-item {
                    margin: 8px 0;
                    padding: 5px;
                    background-color: white;
                    border-left: 2px solid #87CEFA;
                    padding-left: 10px;
                    }

                    table {
                    width: 100%;
                    border-collapse: collapse;
                    margin-bottom: 20px;
                    border: grey solid 1px;
                    table-layout: auto;
                    }

                    thead {
                    background-color: #1E90FF;
                    color: #eeeeee;
                    }

                    th {
                    padding: 10px;
                    text-align: left;
                    font-weight: bold;
                    }

                    th.text-center {
                    text-align: center;
                    }

                    td {
                    padding: 8px;
                    border-bottom: 1px solid #ddd;
                    }

                    tbody tr:nth-child(odd) {
                    background-color: #E6F3FF;
                    }

                    tbody tr:nth-child(even) {
                    background-color: white;
                    }

                    .stat-excellent {
                    color: green;
                    font-weight: bold;
                    }

                    .stat-good {
                    color: #6c9c2e;
                    font-weight: bold;
                    }

                    .stat-medium {
                    color: orange;
                    font-weight: bold;
                    }

                    .stat-low {
                    color: red;
                    font-weight: bold;
                    }

                    .section-divider {
                    margin: 30px 0;
                    page-break-inside: avoid;
                    }
                </style>

                <t t-foreach="course_data" t-as="c_data">
                    <div class="page">
                        <h1 class="text-center">oLearn - Course Information Report</h1>
                        <p class="text-center text-italic">
                            Report Created On:
                            <t t-esc="time.strftime('%Y-%m-%d %H:%M:%S')"/>
                        </p>

                        <!-- COURSE INFO -->
                        <div class="course-info">
                            <p>
                                <span class="info-label">Course Name:</span>
                                <t t-esc="c_data['course'].name"/>
                            </p>
                            <p>
                                <span class="info-label">Description:</span>
                                <t t-esc="c_data['course'].description or 'N/A'"/>
                            </p>
                            <p>
                                <span class="info-label">Teacher:</span>
                                <t t-esc="', '.join(c_data['course'].teacher_id.mapped('name')) or 'N/A'"/>
                            </p>
                            <p>
                                <span class="info-label">Total Students:</span>
                                <t t-esc="len(c_data['course'].student_ids)"/>
                            </p>
                            <p>
                                <span class="info-label">Total Lessons:</span>
                                <t t-esc="len(c_data['lesson_stats'])"/>
                            </p>
                            <p>
                                <span class="info-label">Total Tasks:</span>
                                <t t-esc="len(c_data['task_stats'])"/>
                            </p>
                        </div>

                        <!-- SUMMARY -->
                        <div class="summary-section">
                            <h3>Overall Statistics</h3>
                            <div class="summary-item">
                                <strong>Lesson View Rate:</strong>
                                <t t-set="view_pct" t-value="c_data['overall_view_percentage']"/>
                                <span t-attf-class="#{('stat-excellent' if view_pct >= 90 else 'stat-good' if view_pct >= 70 else 'stat-medium' if view_pct >= 50 else 'stat-low')}">
                                    <t t-esc="'%.1f' % view_pct"/>%
                                </span>
                            </div>
                            <div class="summary-item">
                                <strong>Task Completion Rate:</strong>
                                <t t-set="comp_pct" t-value="c_data['overall_completion_percentage']"/>
                                <span t-attf-class="#{('stat-excellent' if comp_pct >= 90 else 'stat-good' if comp_pct >= 70 else 'stat-medium' if comp_pct >= 50 else 'stat-low')}">
                                    <t t-esc="'%.1f' % comp_pct"/>%
                                </span>
                            </div>
                        </div>

                        <!-- LESSON LIST -->
                        <div class="section-divider">
                            <h2>Lesson List</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Lesson Name</th>
                                        <th class="text-center">Type</th>
                                        <th class="text-center">Students Viewed</th>
                                        <th class="text-center">View Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="c_data['lesson_stats']" t-as="lesson_stat">
                                        <tr>
                                            <td class="text-center">
                                                <t t-esc="lesson_stat_index + 1"/>
                                            </td>
                                            <td>
                                                <t t-esc="lesson_stat['lesson'].name"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="lesson_stat['lesson'].type"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="lesson_stat['viewed_count']"/>
                                                /
                                                <t t-esc="lesson_stat['total_students']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="view_pct" t-value="lesson_stat['view_percentage']"/>
                                                <span t-attf-class="#{('stat-excellent' if view_pct >= 90 else 'stat-good' if view_pct >= 70 else 'stat-medium' if view_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % view_pct"/>%
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>

                        <!-- TASK LIST -->
                        <div class="section-divider">
                            <h2>Task List</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Task Name</th>
                                        <th class="text-center">Max Score</th>
                                        <th class="text-center">Avg Score</th>
                                        <th class="text-center">Completed</th>
                                        <th class="text-center">Completion Rate</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="c_data['task_stats']" t-as="task_stat">
                                        <tr>
                                            <td class="text-center">
                                                <t t-esc="task_stat_index + 1"/>
                                            </td>
                                            <td>
                                                <t t-esc="task_stat['task'].name"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="task_stat['max_score']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="avg_pct"
                                                   t-value="(task_stat['average_score'] / task_stat['max_score'] * 100) if task_stat['max_score'] > 0 else 0"/>
                                                <span t-attf-class="#{('stat-excellent' if avg_pct >= 90 else 'stat-good' if avg_pct >= 70 else 'stat-medium' if avg_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % task_stat['average_score']"/>
                                                </span>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="task_stat['completed_count']"/>
                                                /
                                                <t t-esc="task_stat['total_students']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="comp_pct" t-value="task_stat['completion_percentage']"/>
                                                <span t-attf-class="#{('stat-excellent' if comp_pct >= 90 else 'stat-good' if comp_pct >= 70 else 'stat-medium' if comp_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % comp_pct"/>%
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>

                        <!-- STUDENT LIST -->
                        <div class="section-divider">
                            <h2>Student Performance</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Student Name</th>
                                        <th class="text-center">Lessons Viewed</th>
                                        <th class="text-center">View Rate</th>
                                        <th class="text-center">Tasks Completed</th>
                                        <th class="text-center">Completion Rate</th>
                                        <th class="text-center">Total Score</th>
                                        <th class="text-center">Score %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="c_data['student_stats']" t-as="student_stat">
                                        <tr>
                                            <td class="text-center">
                                                <t t-esc="student_stat_index + 1"/>
                                            </td>
                                            <td>
                                                <t t-esc="student_stat['student'].name"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="student_stat['lessons_viewed']"/>
                                                /
                                                <t t-esc="student_stat['total_lessons']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="lesson_pct" t-value="student_stat['lessons_percentage']"/>
                                                <span t-attf-class="#{('stat-excellent' if lesson_pct >= 90 else 'stat-good' if lesson_pct >= 70 else 'stat-medium' if lesson_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % lesson_pct"/>%
                                                </span>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="student_stat['tasks_completed']"/>
                                                /
                                                <t t-esc="student_stat['total_tasks']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="task_pct" t-value="student_stat['tasks_percentage']"/>
                                                <span t-attf-class="#{('stat-excellent' if task_pct >= 90 else 'stat-good' if task_pct >= 70 else 'stat-medium' if task_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % task_pct"/>%
                                                </span>
                                            </td>
                                            <td class="text-center">
                                                <t t-esc="student_stat['total_score']"/>
                                                /
                                                <t t-esc="student_stat['total_max_score']"/>
                                            </td>
                                            <td class="text-center">
                                                <t t-set="score_pct" t-value="student_stat['score_percentage']"/>
                                                <span t-attf-class="#{('stat-excellent' if score_pct >= 90 else 'stat-good' if score_pct >= 70 else 'stat-medium' if score_pct >= 50 else 'stat-low')}">
                                                    <t t-esc="'%.1f' % score_pct"/>%
                                                </span>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>